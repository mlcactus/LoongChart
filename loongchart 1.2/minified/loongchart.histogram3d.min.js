if(!window.LChart){throw new Error('未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n'+'Not loaded loongchart.core.js which must be loaded before other LChart\'s js.');}else{LChart.Const.Skins.BlackAndWhite.Histogram3D={TopLabelColor:null}}LChart.Histogram3D=LChart.getCore().__extends({GraphType:'Histogram3D'});LChart.Histogram3D._spreadSkin=function(a,b){a.topLabel={};a.topLabel.color=b.TopLabelColor||null};LChart.Histogram3D._getDefaultOptions=function(b){var c=LChart.Methods.Extend(b,{animateY:true,animateX:true,histogram:{colors:null,length:null,gap:null,useSameColor:true},topLabel:{show:true,content:function(a){if(this.valueType=='d'||this.valueType=='t'||this.valueType=='m'){return''}else if(this.valueType=='p'){return a.percent.toFixed(1).toString()+'%'}else{return a.value.toString()}},color:null,fontweight:null,fontsize:null,fontfamily:null}});return c};LChart.Histogram3D._getCheckOptions=function(){return{__top:[['animateY','b'],['animateX','b']],histogram:[['colors','ca'],['length','n'],['gap','n'],['useSameColor','b']],topLabel:[['show','b'],['content','f'],['color','c'],['fontweight','s'],['fontsize','n'],['fontfamily','s']]}};LChart.Histogram3D._drawgraphic=function(s,t,u,v){s._configs.recreateAssists=true;if(t==s.ID){s._configs.notAllowValueNegative=true}var w=s._formatAxisData();var z=s._calculateOutersValid();var A=s._computeAxis(z);var B=s._getDrawableCoordinate();s.shapes[t]={histograms:[]};if(!s.coordinates.histograms){s.coordinates.histograms={}}s.coordinates.histograms[t]=[];var C=s._configs.specificConfig[t];var D=w.vValueType=='p';var E=v.shadow.show&&v.shadow.blur>0;var F=E?{color:v.shadow.color,blur:v.shadow.blur}:null;var G=v.histogram.length;var H=v.histogram.gap;if(w.multiple){if(H&&H>0){var I=(A.labelDistance-w.demanCount*2)/(w.demanCount+1);H=Math.min(H,I)}else{H=A.labelDistance/20}}if(G&&G>0){var J=w.multiple?((A.labelDistance-(w.demanCount+1)*H)/w.demanCount):A.labelDistance*0.8;G=Math.min(G,J)}else{G=(A.labelDistance-(w.demanCount+1)*H)/(w.multiple?(w.demanCount+0.5):1.5)}var K=function(i,k){if(k!=undefined){var a=w.demanCount/2-i;return A.startPos+A.labelDistance*k-a*G-(a-0.5)*H}else{return A.startPos+A.labelDistance*i-G/2}};var L=(v.histogram.colors&&v.histogram.colors.length>0?v.histogram.colors:null)||LChart.Const.Defaults.FillColors;if(t==s.ID){s.coordinates.draw=B;s._configs.legendColors=L;if(w.multiple){s._configs.pointsPosition={labelDistance:A.labelDistance,startPoints:[]};for(var i=0,item;item=u[i];i++){s._configs.pointsPosition[i]=K(i,0)+G/2}}}var M=function(a,b,c,d,e,f){var g=a.left-A.stagewidth*A.sinsightangle;var h=a.top+A.stagewidth*A.cossightangle;var i=b||a.color;if(e){s.DrawFigures.create3DHistogram(g,h,a.width,a.height,i,0,A.sightangle,A.stagewidth,null,c?b:a.topcolor||LChart.Methods.getDarkenColor(i,0.7),c?b:a.rightcolor||LChart.Methods.getDarkenColor(i,0.8),d)}if(f&&v.topLabel.show){var j=v.topLabel;var k=typeof j.content=='function'?j.content.call(v,a.data):'';if(k){var l=(a.left+g)/2+a.width/2;var m=j.fontsize||LChart.Methods.CapValue(a.width/2,18,11);var n=(a.top+h)/2+m/3;s.DrawFigures.createText(k,l,n,'center',a.data.fontweight||j.fontweight,a.data.fontsize||m,j.fontfamily,a.data.fontcolor||j.color)}}};var N=function(f,g,h,i,j,k,l,m,n,o){this.indexX=f;this.indexY=g;this.left=h;this.top=i;this.width=j;this.height=k;this.data=o;this.isHovered=false;this.color=l;this.topcolor=m;this.rightcolor=n;this.redraw=function(a,b,c,d){var e=F;if(E&&d){e=LChart.Methods.DeepCopy(F);e.color=d}M(this,d,a,e,b,c)};this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(v.click||null);if(a){a(this.data,e)}};if(v.tip.show&&typeof v.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=this.left;var b=this.top+this.height/2;this.tip=s._createTip(v.tip.content.call(v,this.data),a,b);if(a+this.tip.clientWidth>A.maxX){s._changeTip(this.tip,a-this.tip.clientWidth)}var c=this;c.tip.onclick=function(e){c.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var O=function(c,d){var e=function(a){var b=(v.animateY?c:1)*(A.maxY-A.minY)*s._getFormatDiff(w.vValueType,w.vMinValue,a)/s._getFormatDiff(w.vValueType,w.vMinValue,w.vMaxValue);return b};var f=d>=1;var g=[];for(var i=0,item;item=u[i];i++){var h=(v.animateX?c:1)*G;if(w.multiple){var j=item.color||L[i%L.length];var l=D?item.percent:item.value;for(var k=0;k<l.length;k++){var m=l[k];var n=K(i,k);var o=e(m);var p=A.maxY-o;var q=null;if(f){q={indexX:k,indexY:i,click:item.click,mouseover:item.mouseover,mouseleave:item.mouseleave,text:item.text,fontsize:item.fontsize,fontcolor:item.fontcolor,fontweight:item.fontweight};if(D){q.percent=m;q.value=item.value[k]}else{q.value=m}if(!s.coordinates.histograms[t][k]){s.coordinates.histograms[t][k]=[]}s.coordinates.histograms[t][k][i]={left:n,top:p,width:h,height:o,color:j}}var r=new N(k,i,n,p,h,o,j,item.topcolor,item.rightcolor,q);g.push(r)}}else{var n=K(i);var o=e(D?item.percent:item.value);var p=A.maxY-o;var j=item.color||(v.histogram.useSameColor?'rgba(69,114,167,1)':L[i%L.length]);if(f){s.coordinates.histograms[t][i]={left:n,top:p,width:h,height:o,color:j}}var r=new N(null,i,n,p,h,o,j,item.topcolor,item.rightcolor,f?item:null);g.push(r)}}if(w.multiple){g.sort(function(a,b){if(a.indexX==b.indexX){return a.indexY-b.indexY}else{return a.indexX-b.indexX}})}for(var i=0,r;r=g[i];i++){M(r,r.color,false,F,true)}if(f){for(var i=0,r;r=g[i];i++){M(r,r.color,false,F,false,true)}s.shapes[t].histograms=g}};var P=function(){var h=function(x,y){var a=null;var b=A.cossightangle*A.stagewidth;var c=A.sinsightangle*A.stagewidth;for(var i=0,shape;shape=s.shapes[t].histograms[i];i++){var d=shape.left-A.stagewidth*A.sinsightangle;var e=shape.top+A.stagewidth*A.cossightangle;if(d<=x&&d+shape.width>=x&&e<=y&&e+shape.height>=y){a=shape;break}}if(!a){for(var i=0,shape;shape=s.shapes[t].histograms[i];i++){if(shape.top<=y&&shape.top+b>=y){var f=shape.left-c*(y-shape.top)/b;if(f<=x&&f+shape.width>=x){a=shape;break}}}}if(!a){for(var i=0,shape;shape=s.shapes[t].histograms[i];i++){if(shape.left+shape.width-c<=x&&shape.left+shape.width>=x){var g=shape.top+b*(shape.left+shape.width-x)/c;if(g<=y&&g+shape.height>=y){a=shape;break}}}}return a};var j=function(e){var e=window.event||e;var a=s._getMouseLoction(e);var b=h(a.X,a.Y);if(b){b.click(e)}};var k=function(e){var e=window.event||e;var a=s._getMouseLoction(e);var b=h(a.X,a.Y);if(b){s._configs.cursorPointer=true}if(C.currentMouseShape!=b){var c=C.currentMouseShape;if(c){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(v.mouseleave||null);if(d){d(c.data,e)}}if(E||C.currentMouseShape||v.topLabel.show){s.redrawAll()}C.currentMouseShape=b;for(var i=0,c;c=s.shapes[t].histograms[i];i++){if(c!=b&&c.isHovered){c.isHovered=false;if(c.hideTip){c.hideTip()}}}if(b){b.isHovered=true;var f=v.mouseoverTransparency;b.redraw(true,true,false,'rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')');if(b.showTip){b.showTip()}var g=typeof b.data.mouseover=='function'?b.data.mouseover:(v.mouseover||null);if(g){g(b.data,e)}}}};s._addEventListener('click',j);s._addEventListener('mousemove',k)};var Q=function(){for(var i=0,shape;shape=s.shapes[t].histograms[i];i++){shape.redraw(false,true)}for(var i=0,shape;shape=s.shapes[t].histograms[i];i++){shape.redraw(false,false,true)}};return{drawSegments:O,mouseEvents:P,redraw:Q}};