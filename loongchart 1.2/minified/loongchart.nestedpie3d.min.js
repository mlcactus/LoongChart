if(!window.LChart){throw new Error('未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n'+'Not loaded loongchart.core.js which must be loaded before other LChart\'s js.');}else{LChart.Const.Skins.BlackAndWhite.NestedPie3D={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:'rgba(255,255,255,0.3)'}}LChart.NestedPie3D=LChart.getCore().__extends({GraphType:'NestedPie3D'});LChart.NestedPie3D._spreadSkin=function(a,b){a.separateLine={};a.innerLabel={};a.outerLabel={};a.separateLine.color=b.SeparateLineColor||null;a.innerLabel.color=b.InnerLabelColor||null;a.outerLabel.color=b.OuterLabelColor||null;a.outerLabel.bordercolor=b.OuterLabelBorderColor||null;a.outerLabel.backcolor=b.OuterLabelBackColor||null};LChart.NestedPie3D._getDefaultOptions=function(b){var c=LChart.Methods.Extend(b,{offX:0,offY:0,innerRadius:null,outerRadius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,reflection3d:{reflectoffX:null,reflectoffY:null,zoomX:null,zoomY:null},subitems:{outerlabalpoint:null,innerlabalpoint:null,inheritevents:true,showinnerlabels:false},separateLine:{color:null,width:null},innerLabel:{show:true,content:function(a){return a.percent.toFixed(1)+'%'},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(a){return a.text+' '+a.percent.toFixed(1)+'%'},withlegend:true,legendtype:null,length:null,color:null,backcolor:'rgba(255,255,255,0.3)',bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return c};LChart.NestedPie3D._getCheckOptions=function(){return{__top:[['offX','n'],['offX','n'],['innerRadius','n'],['outerRadius','n'],['margin','n'],['colors','ca'],['animateRotate','b'],['animateScale','b'],['startAngle','n']],subitems:[['outerlabalpoint','n'],['innerlabalpoint','n'],['inheritevents','b'],['showinnerlabels','b']],separateLine:[['color','c'],['width','n']],innerLabel:[['show','b'],['content','f'],['distance','n'],['color','c'],['fontsize','n'],['fontfamily','s']],outerLabel:[['show','b'],['content','f'],['withlegend','b'],['legendtype','s'],['length','n'],['backcolor','c'],['bordercolor','c'],['borderwidth','n'],['color','c'],['fontsize','n'],['fontfamily','s']]}};LChart.NestedPie3D._drawgraphic=function(E,F,G,H){var I=3;var J=3;var K=H.reflection3d.zoomX||1.2;var L=H.reflection3d.zoomY||0.9;if(E._configs._isIE678.isIE678){K=1;L=1}var M=E._computeRadiusForPies(H,K,L);if(E._configs._isIE678.isIE678){M.maxRadius*=0.9}var N=!H.outerRadius||!LChart.Methods.IsNumber(H.outerRadius)?M.maxRadius:H.outerRadius;var O=H.innerRadius&&H.innerRadius>N*0.1&&H.innerRadius<N?H.innerRadius:N*0.7;if(N<=O){throw new Error(E._messages.WrongSet+E._messages.OuterRadiusShouldBigger);}var P=H.reflection3d.reflectoffX||0;var Q=H.reflection3d.reflectoffY||N/6;var R=H.separateLine.width||1;var S=H.separateLine.color||'#ffffff';var T=Math.PI*(H.startAngle==null?-0.5:H.startAngle);var U=F==E.ID;var V=(H.colors&&H.colors.length>0?H.colors:null)||LChart.Const.Defaults.FillColors;if(U){E.coordinates.draw=M.coordinate;E._configs.legendColors=V}if(!E.coordinates.nestedpie){E.coordinates.nestedpie={}}E.coordinates.nestedpie[F]={outerRadius:N,innerRadius:O,centerX:M.centerX,centerY:M.centerY,cemicircles:[],outerlabels:[]};E.shapes[F]={cemicircles:[],outerlabels:[]};var W=E.shapes[F];var X=0;var Y=[];var Z=[];var ba=[];for(var i=0,item;item=G[i];i++){var bb=item.value;if(typeof bb!='number'||bb<0){throw new Error(E._messages.WrongData+'\''+bb+'\''+E._messages.DataMustGreaterThanZero);}X+=bb;Y[i]=bb;var bc=item.subitems;if(LChart.Methods.IsArray(bc)){Z[i]=true;var bd=0;for(var j=0,subitem;subitem=bc[j];j++){var be=subitem.value;ba.push(be);if(typeof be!='number'||be<0){throw new Error(E._messages.WrongData+'\''+be+'\''+E._messages.DataMustGreaterThanZero);}bd+=be}if(!(Math.abs(bd-bb)<0.00001)){throw new Error(E._messages.WrongData+'\''+bb+'\''+E._messages.SubItemsValueShouldEqualSuperValue);}}else{Z[i]=false}}var bf=true;var bg=H.subitems.inheritevents;var bh=H.subitems.showinnerlabels;var bi=E._configs.specificConfig[F];var bj=H.subitems.outerlabalpoint;var bk=H.subitems.innerlabalpoint;if(bj==null||bk==null){if(ba.length>8){ba.sort(function(x,y){return y-x});var bl=ba[8];if(bj==null){bj=bl}if(bk==null){bk=bl}}}var bm=function(f,g,h,i){var j=(h+i)/2;var k=M.centerX;var l=M.centerY;var m=Math.cos(j);var n=Math.sin(j);var o=k+P;var p=l+Q;var q=O*g;var r=N*g;var s=function(a,b,c){var d=a==0?k:(a==1?l:(a==2?o:p));var e=a==0||a==2?Math.cos:Math.sin;return d+e(b?i:h)*(c?r:q)};var t={isInnerPie:f,midAngle:j,angleMin:h,angleMax:i,innerRadius:q,outerRadius:r,centerX:k,centerY:l,darkCenterX:o,darkCenterY:p,iStartX:s(0,0,0),iStartY:s(1,0,0),iEndX:s(0,1,0),iEndY:s(1,1,0),d_iStartX:s(2,0,0),d_iStartY:s(3,0,0),d_iEndX:s(2,1,0),d_iEndY:s(3,1,0)};if(!f){t.oStartX=s(0,0,1);t.oStartY=s(1,0,1);t.oEndX=s(0,1,1);t.oEndY=s(1,1,1);t.d_oStartX=s(2,0,1);t.d_oStartY=s(3,0,1);t.d_oEndX=s(2,1,1);t.d_oEndY=s(3,1,1)}return t};var bn=function(g,h,j,k,l,m,n,o){this.indexX=g;this.indexY=h;this.percent=j;this.color=k;this.angleMin=l;this.angleMax=m;this.midAngle=n;this.data=o;this.isHovered=false;this.isInnerPie=h==null;this.redraw=function(a){var b=a;for(var i=0;i<4;i++){bp(this.isInnerPie,i,1,this.angleMin,this.angleMax,a||this.color,b,b?a:this.data.darksidecolor)}};this.contact=null;this.superShape=null;this.computeinfo=function(a){if(!this._computeinfo||a){this._computeinfo=bm(this.isInnerPie,1,this.angleMin,this.angleMax)}return this._computeinfo};this.click=function(e,a){var b=typeof this.data.click=='function'?this.data.click:(H.click||null);if(b){b(a||this.data,e)}else if(bg&&this.superShape){this.superShape.click(e,this.data)}};this.mouseover=function(e,a){var b=typeof this.data.mouseover=='function'?this.data.mouseover:(H.mouseover||null);if(b){b(a||this.data,e)}else if(bg&&this.superShape){this.superShape.mouseover(e,this.data)}};this.mouseleave=function(e,a){var b=typeof this.data.mouseleave=='function'?this.data.mouseleave:(H.mouseleave||null);if(b){b(a||this.data,e)}else if(bg&&this.superShape){this.superShape.mouseleave(e,this.data)}};if(H.tip.show&&typeof H.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=(this.angleMin+this.angleMax)/2;var b=this.isInnerPie?O:(N+O);var c=M.centerX+b/2*Math.cos(a);var d=M.centerY+b/2*Math.sin(a);this.tip=E._createTip(H.tip.content(this.data),c*K,d*L);var f=this;f.tip.onclick=function(e){f.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var bo=function(i,j,k,l,m,n,o,p){this.content=i;this.length=j;this.width=k;this.height=l;this.floatright=m;this.floattop=n;this.data=o;this.contact=p;this.color=this.contact.color;this.index=this.contact.index;this.resetposition=function(){var a=p.isInnerPie?O:N;var b=this.length;var c=1.15;var d=this.contact.computeinfo();var e=Math.cos(d.midAngle);var f=Math.sin(d.midAngle);var g=e>0?1+e:0;var h=f>0?f:0;this.startX=(n?d.centerX:(d.centerX+d.darkCenterX)/2)+a*e;this.startY=(n?d.centerY:(d.centerY+d.darkCenterY)/2)+a*f;this.left=(n?d.centerX:d.darkCenterX)+N*c*e+(this.floatright?0:-this.width);this.top=(n?d.centerY:d.darkCenterY)+N*c*f+h*b-b-J};this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2}};var bp=function(a,b,c,d,e,f,g,h,i,j){var k=bm(a,c,d,e);h=h||LChart.Methods.getDarkenColor(f);var l=g?0:R;E.ctx.save();E.ctx.transform(K,0,0,L,0,0);switch(b){case 0:if(a){E.DrawFigures.createArc(k.darkCenterX,k.darkCenterY,k.innerRadius,0,null,h,d,e,true)}else{E.DrawFigures.createRingReflection(k,h,l,S)}break;case 1:if(a){E.DrawFigures.createCloseFigure([[k.darkCenterX,k.darkCenterY],[k.centerX,k.centerY],[k.iEndX,k.iEndY],[k.d_iEndX,k.d_iEndY]],h)}else{E.DrawFigures.createCloseFigure([[k.iStartX,k.iStartY],[k.d_iStartX,k.d_iStartY],[k.d_oStartX,k.d_oStartY],[k.oStartX,k.oStartY]],h)}break;case 2:if(a){E.DrawFigures.createCloseFigure([[k.darkCenterX,k.darkCenterY],[k.centerX,k.centerY],[k.iStartX,k.iStartY],[k.d_iStartX,k.d_iStartY]],h)}else{E.DrawFigures.createCloseFigure([[k.iEndX,k.iEndY],[k.d_iEndX,k.d_iEndY],[k.d_oEndX,k.d_oEndY],[k.oEndX,k.oEndY]],h)}break;default:if(a){E.DrawFigures.createArc(k.centerX,k.centerY,k.innerRadius,l,S,f,d,e,true)}else{E.DrawFigures.createRing(k.centerX,k.centerY,k.innerRadius,k.outerRadius,f,d,e,l,S)}break}E.ctx.restore();var m=H.outerLabel;if(i&&m.show&&typeof m.content=='function'&&((!a&&(bj==null||i.value>bj))||(a&&!Z[j.indexX]))){var n=(d+e)/2;var o=m.length||N/12;var p=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,n);var q=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,n);var r=m.content(i);var s=E.DrawFigures.measureText(r,null,m.fontsize||(o-1),m.fontfamily);var t=s+(m.withlegend?o+3*I:2*I);var u=o+J*2;var v=new bo(r,o,t,u,p?1:0,q?1:0,i,j);W.outerlabels.push(v);j.contact=v}};var bq=function(j){var k=H.innerLabel;if(!(k.show&&typeof k.content=='function')){return}var l=k.distance||0.5;var m=function(a){var b=a.isInnerPie;var c=!a.isInnerPie&&bh&&(bk==null||a.data.value>bk);if(b||c){var d=(a.angleMin+a.angleMax)/2;var e=a.data;var f=b?(O+N)/2*l:O+(N-O)*l;var g=M.centerX+f*Math.cos(d);var h=M.centerY+f*Math.sin(d);E.ctx.save();E.ctx.transform(K,0,0,L,0,0);E.DrawFigures.createText(k.content(e),g,h,'center',e.fontweight,e.fontsize||k.fontsize||N/10,k.fontfamily,e.fontcolor||k.color||LChart.Const.Defaults.InnerLabelColor);E.ctx.restore()}};if(j){m(j)}else{for(var i=0,shape;shape=W.cemicircles[i];i++){m(shape)}}};var br=function(l,m){var n=H.outerLabel;if(!(n.show&&typeof n.content=='function')){return}var o=(U?M.coordinate.minY:5)/L;var p=(U?M.coordinate.maxY:E.canvas.height-5)/L;W.outerlabels.sort(function(a,b){return a.index-b.index});if(bf){for(var i=0,shape;shape=W.outerlabels[i];i++){shape.resetposition()}bf=false}var q=function(){var c=function(a,b){return Math.max(a.left,b.left)<=Math.min(a.left+a.width,b.left+b.width)&&Math.max(a.top,b.top)<=Math.min(a.top+a.height,b.top+b.height)};var d=[];var e=[];var f=[];var g=[];for(var i=0,shape;shape=W.outerlabels[i];i++){while(o>shape.top){shape.top+=J;shape.left+=shape.floatright?I:-I}while(p<shape.top+shape.height){shape.top-=J;shape.left+=shape.floatright?I:-I}if(shape.floatright&&shape.floattop){f.push(shape)}else if(shape.floatright&&!shape.floattop){g.push(shape)}else if(!shape.floatright&&shape.floattop){d.push(shape)}else{e.push(shape)}}var h=0;var j=[];var k=function(r){if(j.length>0){for(var i=0,compare;compare=j[i];i++){while(c(compare,r)&&h<1000){r.top+=r.floattop?J:-J;r.left+=r.floatright?I:-I;h++}}}j.push(r)};for(var i=d.length-1;i>=0;i--){k(d[i])}j=[];for(var i=0;i<e.length;i++){k(e[i])}j=[];for(var i=0;i<f.length;i++){k(f[i])}j=[];for(var i=g.length-1;i>=0;i--){k(g[i])}};var s=function(a,b){var c=a;E.ctx.save();E.ctx.transform(K,0,0,L,0,0);if(!b){E.DrawFigures.createQuadraticCurve(c.startX,c.startY,c.startX*0.8+c.endX()*0.2,c.startY*0.2+c.endY()*0.8,c.endX(),c.endY(),1,n.bordercolor);if(n.backcolor){E.DrawFigures.createRectangleFill(c.left,c.top,c.width,c.height,n.backcolor)}var d=n.fontsize||(c.length-1);var e=c.left+(c.floatright?I+(n.withlegend?c.length+I:0):c.width-I);var f=c.top+c.length/2+d/2+J/2;E.DrawFigures.createText(c.content,e,f,c.floatright?'left':'right',null,d,n.fontfamily,n.color);if(n.borderwidth&&n.borderwidth>0){E.DrawFigures.createRectangleBorder(c.left,c.top,c.width,c.height,n.borderwidth,n.bordercolor)}}if(n.withlegend){var g=n.legendtype||'s';var b=b||c.color;E.DrawFigures.createPointElement(g,c.left+I,c.top+J,c.length,b,g!='x',b,2,g=='x')}E.ctx.restore()};if(l){if(l.contact){s(l.contact,m)}}else{q();E.coordinates.nestedpie[F].outerlabels.length=0;for(var i=0,shape;shape=W.outerlabels[i];i++){s(shape);E.coordinates.nestedpie[F].outerlabels[i]={left:shape.left,top:shape.top,width:shape.width,height:shape.height}}}};var bs=function(){var e=function(a,b,c,d){bp(a.isInnerPie,b,1,a.angleMin,a.angleMax,a.color,false,a.data.darksidecolor)};for(var i=0,shapeitem;shapeitem=W.cemicircles[i];i++){e(shapeitem,0);e(shapeitem,1);e(shapeitem,2)}for(var i=0,shapeitem;shapeitem=W.cemicircles[i];i++){e(shapeitem,3)}bq();br()};var bt=function(e,f){var g=T;var h=g;var k=H.animation&&H.animateScale?e:1;var l=H.animation&&H.animateRotate?e:1;var m=f>=1;var n=[];for(var i=0,item;item=G[i];i++){var o=(item.value/X)*100;var p=l*(o/100*(Math.PI*2));var q=item.color||V[i%V.length];var r=g;var s=g+E._formatSegmentAngle(p);var t=(r+s)/2;if(m){item.percent=o;E.coordinates.nestedpie[F].cemicircles.push({indexX:i,indexY:null,percent:o,radius:O,angleMin:r,angleMax:s,color:q})}var u=new bn(i,null,o,q,r,s,t,item);E._methodsFor3D.computeLoc(u);n.push(u);g=s;var v=item.subitems;if(v&&LChart.Methods.IsArray(v)){for(var j=0,subitem;subitem=v[j];j++){var w=(subitem.value/X)*100;var x=l*(w/100*(Math.PI*2));var y=h;var z=h+E._formatSegmentAngle(x);var A=(y+z)/2;var B=subitem.color||item.subcolor||q;if(m){subitem.percent=w;subitem.subpercent=(subitem.value/Y[i])*100;E.coordinates.nestedpie[F].cemicircles.push({indexX:i,indexY:j,percent:w,innerRadius:O,outerRadius:N,angleMin:y,angleMax:z,color:B})}var C=new bn(i,j,o,B,y,z,A,subitem);C.superShape=u;E._methodsFor3D.computeLoc(C);n.push(C);h=z}}else{h=g}}n.sort(function(a,b){if(a.isInnerPie!=b.isInnerPie){if(a.isInnerPie){return-1}else{return 1}}else{return E._methodsFor3D.pieshapeSort(a,b)}});var D=function(a,b,c,d){bp(a.isInnerPie,b,k,a.angleMin,a.angleMax,a.color,false,a.data.darksidecolor,m&&b==3?a.data:null,m&&b==3?a:null)};for(var i=0,shapeitem;shapeitem=n[i];i++){D(shapeitem,0);D(shapeitem,1);D(shapeitem,2)}for(var i=0,shapeitem;shapeitem=n[i];i++){D(shapeitem,3)}if(m){W.cemicircles=n;bq();br()}};var bu=function(){var m=function(x,y){var a=null;for(var i=0,h;h=W.cemicircles[i];i++){var b=(h.angleMin+h.angleMax)/2;var c=LChart.Methods.GetCurrentAngle(x,y,M.centerX,M.centerY);var d=Math.pow(x-M.centerX,2)+Math.pow(y-M.centerY,2);var e=(h.isInnerPie&&d<=Math.pow(O,2)||!h.isInnerPie&&d>Math.pow(O,2)&&d<=Math.pow(N,2))&&LChart.Methods.JudgeBetweenAngle(h.angleMin,h.angleMax,c);var f=false;if(H.outerLabel&&H.outerLabel.show&&h.contact){var g=h.contact;if(x>=g.left&&x<=g.left+g.width&&y>=g.top&&y<=g.top+g.height){f=true}}if(e||f){a=h;break}}if(!a){for(var i=W.cemicircles.length-1;i>=0;i--){var h=W.cemicircles[i];var j=h.computeinfo();var d=Math.pow(x-j.darkCenterX,2)+Math.pow(y-j.darkCenterY,2);var k=LChart.Methods.GetCurrentAngle(x,y,j.darkCenterX,j.darkCenterY);var l=(h.isInnerPie&&d<=Math.pow(O,2)||!h.isInnerPie&&d>Math.pow(O,2)&&d<=Math.pow(N,2))&&LChart.Methods.JudgeBetweenAngle(h.angleMin,h.angleMax,k);if(l){a=h;break}}}return a};var n=function(e){var e=window.event||e;var a=LChart.Methods.tranferLocation(E._getMouseLoction(e),K,L);var b=m(a.X,a.Y);if(b){b.click(e)}};var o=function(e){var e=window.event||e;var a=LChart.Methods.tranferLocation(E._getMouseLoction(e),K,L);var b=m(a.X,a.Y);if(b){E._configs.cursorPointer=true}if(bi.currentMouseShape!=b){var c=bi.currentMouseShape;if(c){c.mouseleave(e)}if(bi.currentMouseShape){E.redrawAll()}bi.currentMouseShape=b;for(var i=0,c;c=W.cemicircles[i];i++){if(c.isHovered){c.isHovered=false;if(c.hideTip){c.hideTip()}}}if(b){b.isHovered=true;var d=H.mouseoverTransparency;var f='rgba(255,255,255,'+(d>0&&d<1?d:0.2)+')';b.redraw(f);br(b,f);if(b.showTip){b.showTip()}b.mouseover(e)}}};E._addEventListener('click',n);E._addEventListener('mousemove',o)};return{drawSegments:bt,mouseEvents:bu,redraw:bs}};