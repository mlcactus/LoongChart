if(!window.LChart){throw new Error('未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n'+'Not loaded loongchart.core.js which must be loaded before other LChart\'s js.');}else{LChart.Const.Skins.BlackAndWhite.Histogram={TopLabelColor:null}}LChart.Histogram=LChart.getCore().__extends({GraphType:'Histogram'});LChart.Histogram._spreadSkin=function(a,b){a.topLabel={};a.topLabel.color=b.TopLabelColor||null};LChart.Histogram._getDefaultOptions=function(b){var c=LChart.Methods.Extend(b,{animateY:true,animateX:true,histogram:{colors:null,length:null,gap:null,useSameColor:true},topLabel:{show:true,content:function(a){if(this.valueType=='d'||this.valueType=='t'||this.valueType=='m'){return''}else if(this.valueType=='p'){return a.percent.toFixed(1).toString()+'%'}else{return a.value.toString()}},color:null,fontweight:null,fontsize:null,fontfamily:null}});return c};LChart.Histogram._getCheckOptions=function(){return{__top:[['animateY','b'],['animateX','b']],histogram:[['colors','ca'],['length','n'],['gap','n'],['useSameColor','b']],topLabel:[['show','b'],['content','f'],['color','c'],['fontweight','s'],['fontsize','n'],['fontfamily','s']]}};LChart.Histogram._drawgraphic=function(q,r,s,t){if(r==q.ID){q._configs.notAllowValueNegative=true}var u=q._formatAxisData();var v=q._calculateOutersValid();var w=q._computeAxis(v);var z=q._getDrawableCoordinate();q.shapes[r]={histograms:[]};if(!q.coordinates.histograms){q.coordinates.histograms={}}q.coordinates.histograms[r]=[];var A=q._configs.specificConfig[r];var B=u.vValueType=='p';var C=t.shadow.show&&t.shadow.blur>0;var D=C?t.shadow:null;if(D){if(D.blur&&D.offsetY>-D.blur){D.offsetY=-D.blur}}var E=t.histogram.length;var F=t.histogram.gap;if(u.multiple){if(F&&F>0){var G=(w.labelDistance-u.demanCount*2)/(u.demanCount+1);F=Math.min(F,G)}else{F=w.labelDistance/20}}else{F=0}if(E&&E>0){var H=u.multiple?((w.labelDistance-(u.demanCount+1)*F)/u.demanCount):w.labelDistance*0.8;E=Math.min(E,H)}else{E=(w.labelDistance-(u.demanCount+1)*F)/(u.multiple?(u.demanCount+0.5):1.5)}var I=function(i,k){if(k!=undefined){var a=u.demanCount/2-i;return w.startPos+w.labelDistance*k-a*E-(a-0.5)*F}else{return w.startPos+w.labelDistance*i-E/2}};var J=(t.histogram.colors&&t.histogram.colors.length>0?t.histogram.colors:null)||LChart.Const.Defaults.FillColors;if(r==q.ID){q.coordinates.draw=z;q._configs.legendColors=J;if(u.multiple){q._configs.pointsPosition={labelDistance:w.labelDistance,startPoints:[]};for(var i=0,item;item=s[i];i++){q._configs.pointsPosition[i]=I(i,0)+E/2}}}var K=function(a,b,c,d,e,f,g){q.DrawFigures.createRectangleFill(a,b,c,d,e,g||D);if(f&&t.topLabel.show){var h=t.topLabel;var i=typeof h.content=='function'?h.content.call(t,f):'';if(i){var j=a+c/2;var k=h.fontsize||LChart.Methods.CapValue(c/2,18,11);var l=b-k/2;q.DrawFigures.createText(i,j,l,'center',f.fontweight||h.fontweight,f.fontsize||k,h.fontfamily,f.fontcolor||h.color)}}};var L=function(d,f,g,h,i,j,k,l){this.indexX=d;this.indexY=f;this.left=g;this.top=h;this.width=i;this.height=j;this.data=l;this.isHovered=false;this.color=k;this.redraw=function(a,b){if(arguments.length==1&&typeof arguments[0]=='boolean'){b=arguments[0];a=undefined}var c=D;if(D&&D.show&&a){c=LChart.Methods.DeepCopy(D);c.color=a}K(this.left,this.top,this.width,this.height,a||this.color,b?this.data:null,c)};this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(t.click||null);if(a){a(this.data,e)}};if(t.tip.show&&typeof t.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=this.left+this.width/2+5;var b=this.top+this.height/2;this.tip=q._createTip(t.tip.content.call(t,this.data),a,b);if(a+this.tip.clientWidth>w.maxX){q._changeTip(this.tip,a-this.tip.clientWidth)}var c=this;c.tip.onclick=function(e){c.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var M=function(c,d){var e=function(a){var b=(t.animateY?c:1)*(w.maxY-w.minY)*q._getFormatDiff(u.vValueType,u.vMinValue,a)/q._getFormatDiff(u.vValueType,u.vMinValue,u.vMaxValue);return b};for(var i=0,item;item=s[i];i++){var f=(t.animateX?c:1)*E;if(u.multiple){var g=item.color||J[i%J.length];var h=B?item.percent:item.value;for(var k=0;k<h.length;k++){var j=h[k];var l=I(i,k);var m=e(j);var n=w.maxY-m;if(d>=1){var o={click:item.click,mouseover:item.mouseover,mouseleave:item.mouseleave,text:item.text,indexX:k,indexY:i,fontsize:item.fontsize,fontcolor:item.fontcolor,fontweight:item.fontweight};if(B){o.percent=j;o.value=item.value[k]}else{o.value=j}var p=new L(k,i,l,n,f,m,g,o);q.shapes[r].histograms.push(p);K(l,n,f,m,g,o);if(!q.coordinates.histograms[r][k]){q.coordinates.histograms[r][k]=[]}q.coordinates.histograms[r][k][i]={left:l,top:n,width:f,height:m,color:g}}else{K(l,n,f,m,g)}}}else{var l=I(i);var m=e(B?item.percent:item.value);var n=w.maxY-m;var g=item.color||(t.histogram.useSameColor?'rgba(69,114,167,1)':J[i%J.length]);if(d>=1){item.indexX=i;item.indexY=1;var p=new L(i,1,l,n,f,m,g,item);q.shapes[r].histograms.push(p);K(l,n,f,m,g,item);q.coordinates.histograms[r][i]={left:l,top:n,width:f,height:m,color:g}}else{K(l,n,f,m,g)}}}};var N=function(){var h=function(x,y){var a=null;for(var i=0,shape;shape=q.shapes[r].histograms[i];i++){if(shape.left<=x&&shape.left+shape.width>=x&&shape.top<=y&&shape.top+shape.height>=y){a=shape;break}}return a};var j=function(e){var e=window.event||e;var a=q._getMouseLoction(e);var b=h(a.X,a.Y);if(b){b.click(e)}};var k=function(e){var e=window.event||e;var a=q._getMouseLoction(e);var b=h(a.X,a.Y);if(b){q._configs.cursorPointer=true}if(A.currentMouseShape!=b){var c=A.currentMouseShape;if(c){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(t.mouseleave||null);if(d){d(c.data,e)}}if(C||A.currentMouseShape){q.redrawAll()}A.currentMouseShape=b;for(var i=0,c;c=q.shapes[r].histograms[i];i++){if(c!=b&&c.isHovered){c.isHovered=false;if(c.hideTip){c.hideTip()}}}if(b){b.isHovered=true;var f=t.mouseoverTransparency;b.redraw('rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')');if(b.showTip){b.showTip()}var g=typeof b.data.mouseover=='function'?b.data.mouseover:(t.mouseover||null);if(g){g(b.data,e)}}}};q._addEventListener('click',j);q._addEventListener('mousemove',k)};var O=function(){for(var i=0,shape;shape=q.shapes[r].histograms[i];i++){shape.redraw(true)}};return{drawSegments:M,mouseEvents:N,redraw:O}};