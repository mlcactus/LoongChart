if(!window.LChart){throw new Error('未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n'+'Not loaded loongchart.core.js which must be loaded before other LChart\'s js.');}else{LChart.Const.Skins.BlackAndWhite.Pie={SeparateLineColor:null,InnerLabelColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:'rgba(255,255,255,0.3)'}}LChart.Pie=LChart.getCore().__extends({GraphType:'Pie'});LChart.Pie._spreadSkin=function(a,b){a.separateLine={};a.innerLabel={};a.outerLabel={};a.separateLine.color=b.SeparateLineColor||null;a.innerLabel.color=b.InnerLabelColor||null;a.outerLabel.color=b.OuterLabelColor||null;a.outerLabel.bordercolor=b.OuterLabelBorderColor||null;a.outerLabel.backcolor=b.OuterLabelBackColor||null};LChart.Pie._getDefaultOptions=function(b){var c=LChart.Methods.Extend(b,{offX:0,offY:0,radius:null,margin:null,colors:null,animateRotate:true,animateScale:true,startAngle:null,clickout:true,separateLine:{show:false,color:null,width:null},innerLabel:{show:true,content:function(a){return a.percent.toFixed(1)+'%'},distance:null,color:null,fontsize:null,fontfamily:null},outerLabel:{show:true,content:function(a){return a.text+' '+a.percent.toFixed(1)+'%'},withlegend:true,legendtype:null,length:null,color:null,backcolor:'rgba(255,255,255,0.3)',bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return c};LChart.Pie._getCheckOptions=function(){return{__top:[['offX','n'],['offX','n'],['radius','n'],['margin','n'],['colors','ca'],['animateRotate','b'],['animateScale','b'],['startAngle','n'],['clickout','b']],separateLine:[['show','b'],['color','c'],['width','n']],innerLabel:[['show','b'],['content','f'],['distance','n'],['color','c'],['fontsize','n'],['fontfamily','s']],outerLabel:[['show','b'],['content','f'],['withlegend','b'],['legendtype','s'],['length','n'],['backcolor','c'],['bordercolor','c'],['borderwidth','n'],['color','c'],['fontsize','n'],['fontfamily','s']]}};LChart.Pie._drawgraphic=function(w,z,A,B){var C=w._computeSegmentTotal(A).segmentTotal;var D=w._computeRadiusForPies(B);var E=!B.radius||!LChart.Methods.IsNumber(B.radius)?D.maxRadius:B.radius;var F=E/10;var G=z==w.ID;var H=(B.colors&&B.colors.length>0?B.colors:null)||LChart.Const.Defaults.FillColors;if(G){w.coordinates.draw=D.coordinate;w._configs.legendColors=H}w.shapes[z]={cemicircles:[],outerLabels:[]};var I=w.shapes[z];if(!w.coordinates.pie){w.coordinates.pie={}}w.coordinates.pie[z]={radius:E,centerX:D.centerX,centerY:D.centerY,cemicircles:[],outerlabels:[]};var J=3;var K=3;var L=true;var M=w._configs.specificConfig[z];var N=function(f,g,h,i,j){this.index=f;this.angleMin=g;this.angleMax=h;this.data=i;this.isHovered=false;this.isClickout=j;this.color=function(){return this.data.color||H[this.index%H.length]};this.redraw=function(a,b){P(a,1,this.angleMin,this.angleMax,b||this.color())};this.contact=null;this.click=function(e,a){if(B.clickout){L=true;this.isClickout=!this.isClickout;w.redrawAll();var b=B.mouseoverTransparency;var c='rgba(255,255,255,'+(b>0&&b<1?b:0.2)+')';this.redraw(this.isClickout,c);R(this,c)}if(!B.clickout||this.isClickout){var d=typeof this.data.click=='function'?this.data.click:(B.click||null);if(d){d(this.data,e)}}};if(B.tip.show&&typeof B.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=(this.angleMin+this.angleMax)/2;var b=D.centerX+E*0.5*Math.cos(a);var c=D.centerY+E*0.5*Math.sin(a);this.tip=w._createTip(B.tip.content(this.data),b,c);var d=this;d.tip.onclick=function(e){d.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var O=function(j,k,l,m,n,o,p,q){this.content=j;this.length=k;this.width=l;this.height=m;this.floatright=n;this.floattop=o;this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2};this.data=p;this.contact=q;this.color=function(){return this.contact.color()};this.index=function(){return this.contact.index};this.resetposition=function(){var a=this.length;var b=D.centerX;var c=D.centerY;var d=(this.contact.angleMin+this.contact.angleMax)/2;var e=Math.cos(d);var f=Math.sin(d);if(this.contact.isClickout){b+=F*e;c+=F*f}var g=1.15;var h=e>0?1+e:0;var i=f>0?f:0;this.startX=b+E*e;this.startY=c+E*f;this.left=b+E*g*e+(this.floatright?0:-this.width);this.top=c+E*g*f+i*a-a-K}};var P=function(a,b,c,d,e,f,g){var h=(c+d)/2;var i=D.centerX;var j=D.centerY;var k=Math.cos(h);var l=Math.sin(h);if(a){i+=F*k;j+=F*l}var m=B.separateLine.show?(B.separateLine.width||1):0;w.DrawFigures.createArc(i,j,E*b,m,B.separateLine.color,e,c,d,true);var n=B.outerLabel;if(f&&n.show&&typeof n.content=='function'){var o=n.length||E/12;var p=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,h);var q=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,h);var r=n.content(f);var s=w.DrawFigures.measureText(r,null,n.fontsize||(o-1),n.fontfamily);var t=s+(n.withlegend?o+3*J:2*J);var u=o+K*2;var v=new O(r,o,t,u,p?1:0,q?1:0,f,g);I.outerLabels.push(v);g.contact=v}};var Q=function(g){var h=B.innerLabel;if(!(h.show&&typeof h.content=='function')){return}var j=h.distance||0.6;var k=function(a){var b=(a.angleMin+a.angleMax)/2;var c=a.data;var d=a.isClickout?(E*j+F):E*j;var e=D.centerX+d*Math.cos(b);var f=D.centerY+d*Math.sin(b);w.DrawFigures.createText(h.content(c),e,f,'center',c.fontweight,c.fontsize||h.fontsize||E/10,h.fontfamily,c.fontcolor||h.color||LChart.Const.Defaults.InnerLabelColor)};if(g){k(g)}else{for(var i=0,shape;shape=I.cemicircles[i];i++){k(shape)}}};var R=function(l,m){var n=B.outerLabel;if(!(n.show&&typeof n.content=='function')){return}var o=G?D.coordinate.minY:5;var p=G?D.coordinate.maxY:w.canvas.height-5;if(L){for(var i=0,shape;shape=I.outerLabels[i];i++){shape.resetposition()}L=false}var q=function(){var c=function(a,b){return Math.max(a.left,b.left)<=Math.min(a.left+a.width,b.left+b.width)&&Math.max(a.top,b.top)<=Math.min(a.top+a.height,b.top+b.height)};var d=[];var e=[];var f=[];var g=[];for(var i=0,shape;shape=I.outerLabels[i];i++){while(o>shape.top){shape.top+=K;shape.left+=shape.floatright?J:-J}while(p<shape.top+shape.height){shape.top-=K;shape.left+=shape.floatright?J:-J}if(shape.floatright&&shape.floattop){f.push(shape)}else if(shape.floatright&&!shape.floattop){g.push(shape)}else if(!shape.floatright&&shape.floattop){d.push(shape)}else{e.push(shape)}}var h=0;var j=[];var k=function(r){if(j.length>0){for(var i=0,compare;compare=j[i];i++){while(c(compare,r)&&h<1000){r.top+=r.floattop?K:-K;r.left+=r.floatright?J:-J;h++}}}j.push(r)};for(var i=d.length-1;i>=0;i--){k(d[i])}j=[];for(var i=0;i<e.length;i++){k(e[i])}j=[];for(var i=0;i<f.length;i++){k(f[i])}j=[];for(var i=g.length-1;i>=0;i--){k(g[i])}};var s=function(a,b){var c=a;if(!b){w.DrawFigures.createQuadraticCurve(c.startX,c.startY,c.startX*0.8+c.endX()*0.2,c.startY*0.2+c.endY()*0.8,c.endX(),c.endY(),1,n.bordercolor);if(n.backcolor){w.DrawFigures.createRectangleFill(c.left,c.top,c.width,c.height,n.backcolor)}var d=n.fontsize||(c.length-1);var e=c.left+(c.floatright?J+(n.withlegend?c.length+J:0):c.width-J);var f=c.top+c.length/2+d/2+K/2;w.DrawFigures.createText(c.content,e,f,c.floatright?'left':'right',null,d,n.fontfamily,n.color);if(n.borderwidth&&n.borderwidth>0){w.DrawFigures.createRectangleBorder(c.left,c.top,c.width,c.height,n.borderwidth,n.bordercolor)}}if(n.withlegend){var g=n.legendtype||'s';var b=b||c.color();w.DrawFigures.createPointElement(g,c.left+J,c.top+K,c.length,b,g!='x',b,2,g=='x')}};if(l){s(l.contact,m)}else{q();w.coordinates.pie[z].outerlabels.length=0;for(var i=0,shape;shape=I.outerLabels[i];i++){s(shape);w.coordinates.pie[z].outerlabels[i]={index:shape.contact.index,left:shape.left,top:shape.top,width:shape.width,height:shape.height}}}};var S=function(){for(var i=0,shape;shape=I.cemicircles[i];i++){shape.redraw(shape.isClickout)}Q();R()};var T=function(a,b){var c=Math.PI*(B.startAngle==null?-0.5:B.startAngle);var d=B.animation&&B.animateScale?a:1;var e=B.animation&&B.animateRotate?a:1;for(var i=0,item;item=A[i];i++){var f=(item.value/C)*100;var g=e*(f/100*(Math.PI*2));var h=item.color||H[i%H.length];var j=c+w._formatSegmentAngle(g);if(b>=1){item.index=i;item.percent=f;var k=new N(i,c,j,item,item.extended==true);I.cemicircles.push(k);P(item.extended,d,c,j,h,item,k);w.coordinates.pie[z].cemicircles.push({index:i,percent:f,angleMin:c,angleMax:j,color:h})}else{P(item.extended,d,c,j,h)}c=j}if(b>=1){Q();R()}};var U=function(){var l=function(x,y){var a=null;for(var i=0,shape;shape=I.cemicircles[i];i++){var b=(shape.angleMin+shape.angleMax)/2;var c=F*Math.cos(b);var d=F*Math.sin(b);var e=D.centerX+(shape.isClickout?c:0);var f=D.centerY+(shape.isClickout?d:0);var g=LChart.Methods.GetCurrentAngle(x,y,e,f);var h=(Math.pow(x-e,2)+Math.pow(y-f,2)<=Math.pow(E,2))&&LChart.Methods.JudgeBetweenAngle(shape.angleMin,shape.angleMax,g);var j=false;if(B.outerLabel&&B.outerLabel.show&&shape.contact){var k=shape.contact;if(x>=k.left&&x<=k.left+k.width&&y>=k.top&&y<=k.top+k.height){j=true}}if(h||j){a=shape;break}}return a};var m=function(e){var e=window.event||e;var a=w._getMouseLoction(e);var b=l(a.X,a.Y);if(b){b.click(e)}};var n=function(e){var e=window.event||e;var a=w._getMouseLoction(e);var b=l(a.X,a.Y);if(b){w._configs.cursorPointer=true}if(M.currentMouseShape!=b){var c=M.currentMouseShape;if(c){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(B.mouseleave||null);if(d){d(c.data,e)}}if(M.currentMouseShape){w.redrawAll()}M.currentMouseShape=b;for(var i=0,c;c=I.cemicircles[i];i++){if(c.isHovered){c.isHovered=false;if(c.hideTip){c.hideTip()}}}if(b){b.isHovered=true;var f=B.mouseoverTransparency;var g='rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')';b.redraw(b.isClickout,g);R(b,g);if(b.showTip){b.showTip()}var h=typeof b.data.mouseover=='function'?b.data.mouseover:(B.mouseover||null);if(h){h(b.data,e)}}}};w._addEventListener('click',m);w._addEventListener('mousemove',n)};return{drawSegments:T,mouseEvents:U,redraw:S}};