if(!window.LChart){throw new Error('未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n'+'Not loaded loongchart.core.js which must be loaded before other LChart\'s js.');}else{LChart.Const.Skins.BlackAndWhite.HeapHistogram={CutLinecolor:null,InnerLabelColor:null}}LChart.HeapHistogram=LChart.getCore().__extends({GraphType:'HeapHistogram'});LChart.HeapHistogram._spreadSkin=function(a,b){a.histogram={};a.label={};a.histogram.cutlinecolor=b.CutLinecolor||null;a.label.color=b.InnerLabelColor||null};LChart.HeapHistogram._getDefaultOptions=function(b){var c=LChart.Methods.Extend(b,{animateY:true,animateX:true,histogram:{colors:null,length:null,cutlinecolor:null,cutlinewidth:null},label:{show:true,content:function(a){return this.valueType=='p'?a.percent.toFixed(1)+'%':a.value.toString()},color:null,fontweight:null,fontsize:null,fontfamily:null}});return c};LChart.HeapHistogram._getCheckOptions=function(){return{__top:[['animateY','b'],['animateX','b']],histogram:[['colors','ca'],['length','n'],['cutlinecolor','c'],['cutlinewidth','n']],label:[['show','b'],['content','f'],['color','c'],['fontweight','s'],['fontsize','n'],['fontfamily','s']]}};LChart.HeapHistogram._drawgraphic=function(v,w,z,A){if(A.valueType&&A.valueType!='n'&&A.valueType!='p'){throw new Error(v._messages.WrongParam+v._messages.ValueTypeMustBeNumberOrPercent);}if(!LChart.Methods.IsArray(z[0].value)||z[0].value.length<1){throw new Error(v._messages.WrongData+v._messages.DataMustBeMultipleArray);}if(w==v.ID){v._configs.notAllowValueNegative=true}var B=v._formatAxisData(true);var C=v._calculateOutersValid();var D=v._computeAxis(C);var E=v._getDrawableCoordinate();var F=Math.floor(A.histogram.cutlinewidth||0);var G=A.histogram.cutlinecolor||'#ffffff';var H=F>0;var I=B.vValueType=='p';var J=A.histogram.length;if(J&&J>0){var K=D.labelDistance*0.8;J=Math.min(J,K)}else{J=D.labelDistance*0.6}var L=(A.histogram.colors&&A.histogram.colors.length>0?A.histogram.colors:null)||LChart.Const.Defaults.FillColors;if(w==v.ID){v.coordinates.draw=E;v._configs.legendColors=L}var M=v._configs.specificConfig[w];v.shapes[w]={histograms:[]};if(!v.coordinates.histograms){v.coordinates.histograms={}}v.coordinates.histograms[w]=[];var N=function(a,b,c,d,e,f,g){if(!g){v.DrawFigures.createRectangleFill(a,b,c,d,e)}if(f&&A.label.show){var h=A.label;var i=typeof h.content=='function'?h.content.call(A,f):'';if(i){var j=a+c/2;var k=h.fontsize||LChart.Methods.CapValue(c/2,18,11);var l=b+d/2+k/3;var e=h.color||'#ffffff';v.DrawFigures.createText(i,j,l,'center',f.fontweight||h.fontweight,f.fontsize||k,h.fontfamily,f.fontcolor||e)}}};var O=function(d,f,g,h,i,j,k,l,m){this.indexX=d;this.indexY=f;this.left=g;this.top=h;this.width=i;this.height=j;this.data=l;this.linetop=m;this.isHovered=false;this.color=k;this.redrawrect=function(a){N(this.left,this.top,this.width,this.height,a||this.color)};this.redrawtext=function(){N(this.left,this.top,this.width,this.height,k||this.color,this.data,true)};this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(A.click||null);if(a){a(this.data,e)}};if(A.tip.show&&typeof A.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=this.left+this.width;var b=this.top+this.height/2;this.tip=v._createTip(A.tip.content.call(A,this.data),a,b);if(a+this.tip.clientWidth>D.maxX){v._changeTip(this.tip,a-this.tip.clientWidth-this.width)}var c=this;c.tip.onclick=function(e){c.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var P=function(c,d){var e=function(a){var b=(A.animateY?c:1)*(D.maxY-D.minY)*v._getFormatDiff(B.vValueType,B.vMinValue,a)/v._getFormatDiff(B.vValueType,B.vMinValue,B.vMaxValue);return b};var f=(A.animateX?c:1)*J;for(var i=0;i<B.tuftCount;i++){var g=D.startPos+D.labelDistance*i-J/2;var h=0;var l=[];var m=[];for(var k=0;k<B.demanCount;k++){var n=z[k];var o=n.color||L[k%L.length];var p=I?n.percent:n.value;var q=e(p[i]);h+=q;var r=D.maxY-h;if(r<D.minY+1){q-=D.minY+1-r;r=D.minY+1}if(k<B.demanCount-1){r+=F/2}if(k==B.demanCount-1||k==0){q-=F/2}else{q-=F}if(q+r>D.maxY){q=D.maxY-r}var s=null;if(H&&k<B.demanCount-1){s=r-F/2;if(s+F/2+1>D.maxY){s=D.maxY-F/2-1}l.push(s)}if(d>=1){var t={click:n.click,mouseover:n.mouseover,mouseleave:n.mouseleave,text:n.text,indexX:i,indexY:k,fontsize:n.fontsize,fontcolor:n.fontcolor,fontweight:n.fontweight};if(I){t.percent=p[i];t.value=n.value[i]}else{t.value=p[i]}var u=new O(k,i,g,r,f,q,o,t,s);v.shapes[w].histograms.push(u);m.push(u);u.redrawrect();if(!v.coordinates.histograms[w][i]){v.coordinates.histograms[w][i]=[]}v.coordinates.histograms[w][i][k]={left:g,top:r,width:f,height:q,color:o}}else{N(g,r,f,q,o)}}if(H){for(var j=0;j<l.length;j++){v.DrawFigures.createLine(g,l[j],g+f,l[j],F,G)}}if(d>=1){for(var j=0,u;u=m[j];j++){u.redrawtext()}}}};var Q=function(){var h=function(x,y){var a=null;for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){if(shape.left<=x&&shape.left+shape.width>=x&&shape.top<=y&&shape.top+shape.height>=y){a=shape;break}}return a};var j=function(e){var e=window.event||e;var a=v._getMouseLoction(e);var b=h(a.X,a.Y);if(b){b.click(e)}};var k=function(e){var e=window.event||e;var a=v._getMouseLoction(e);var b=h(a.X,a.Y);if(b){v._configs.cursorPointer=true}if(M.currentMouseShape!=b){var c=M.currentMouseShape;if(c){c.isHovered=false;if(c.hideTip){c.hideTip()}var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(A.mouseleave||null);if(d){d(c.data,e)}}if(M.currentMouseShape){v.redrawAll()}M.currentMouseShape=b;if(b){b.isHovered=true;var f=A.mouseoverTransparency;b.redrawrect('rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')');if(b.showTip){b.showTip()}var g=typeof b.data.mouseover=='function'?b.data.mouseover:(A.mouseover||null);if(g){g(b.data,e)}}}};v._addEventListener('click',j);v._addEventListener('mousemove',k)};var R=function(){for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){shape.redrawrect()}for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){if(shape.linetop!=null){v.DrawFigures.createLine(shape.left,shape.linetop,shape.left+shape.width,shape.linetop,F,G)}}for(var i=0,shape;shape=v.shapes[w].histograms[i];i++){shape.redrawtext()}};return{drawSegments:P,mouseEvents:Q,redraw:R}};