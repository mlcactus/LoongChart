if(!window.LChart){throw new Error('未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n'+'Not loaded loongchart.core.js which must be loaded before other LChart\'s js.');}else{LChart.Const.Skins.BlackAndWhite.RangeHistogram={SmallLabelColor:null,BigLabelColor:null}}LChart.RangeHistogram=LChart.getCore().__extends({GraphType:'RangeHistogram'});LChart.RangeHistogram._spreadSkin=function(a,b){a.smallLabel={};a.smallLabel.color=b.SmallLabelColor||null;a.bigLabel={};a.bigLabel.color=b.BigLabelColor||null};LChart.RangeHistogram._getDefaultOptions=function(c){var d=LChart.Methods.Extend(c,{animateY:true,animateX:true,histogram:{colors:null,length:null,gap:null,useSameColor:true},tip:{content:function(a){var b=null;if(this.valueType=='d'){b='<br/>Small Value: '+a.value[0].format('yyyy-MM-dd')+'<br/>Big Value: '+a.value[1].format('yyyy-MM-dd')}else if(this.valueType=='t'){b='<br/>Small Value: '+a.value[0].format('MM-dd hh:mm')+'<br/>Big Value: '+a.value[1].format('MM-dd hh:mm')}else if(this.valueType=='m'){b='<br/>Small Value: '+a.value[0].format('hh:mm:ss.S')+'<br/>Big Value: '+a.value[1].format('hh:mm:ss.S')}else{b='<br/>Small Value: '+a.value[0]+'<br/>Big Value: '+a.value[1]}return'<div>'+a.text+'：'+b+'&nbsp;</div>'}},smallLabel:{show:true,content:function(a){if(this.valueType=='d'){return a.format('yyyy-MM-dd')}else if(this.valueType=='t'){return a.format('MM-dd hh:mm')}else if(this.valueType=='m'){return a.format('hh:mm:ss.S')}else{return a.toString()}},color:null,fontweight:null,fontsize:null,fontfamily:null},bigLabel:{show:true,content:function(a){if(this.valueType=='d'){return a.format('yyyy-MM-dd')}else if(this.valueType=='t'){return a.format('MM-dd hh:mm')}else if(this.valueType=='m'){return a.format('hh:mm:ss.S')}else{return a.toString()}},color:null,fontweight:null,fontsize:null,fontfamily:null}});return d};LChart.RangeHistogram._getCheckOptions=function(){return{__top:[['animateY','b'],['animateX','b']],histogram:[['colors','ca'],['length','n'],['gap','n'],['useSameColor','b']],smallLabel:[['show','b'],['content','f'],['color','c'],['fontweight','s'],['fontsize','n'],['fontfamily','s']],bigLabel:[['show','b'],['content','f'],['color','c'],['fontweight','s'],['fontsize','n'],['fontfamily','s']]}};LChart.RangeHistogram._drawgraphic=function(u,v,w,z){if(z.valueType=='p'){throw new Error(u._messages.WrongParam+u._messages.ValueTypeMustNotBePercent);}if(v==u.ID){u._configs.valueAxiaDataIsRange=true}var A=u._formatAxisData();var B=u._calculateOutersValid();var C=u._computeAxis(B);var D=u._getDrawableCoordinate();u.shapes[v]={histograms:[]};if(!u.coordinates.histograms){u.coordinates.histograms={}}u.coordinates.histograms[v]=[];var E=u._configs.specificConfig[v];var F=z.shadow.show&&z.shadow.blur>0;var G=z.shadow.show?z.shadow:null;var H=A.vValueType=='p';var I=z.histogram.length;var J=z.histogram.gap;if(A.multiple){if(J&&J>0){var K=(C.labelDistance-A.demanCount*2)/(A.demanCount+1);J=Math.min(J,K)}else{J=C.labelDistance/20}}else{J=0}var I=z.histogram.length;if(I&&I>0){var L=A.multiple?((C.labelDistance-(A.demanCount+1)*J)/A.demanCount):C.labelDistance*0.8;I=Math.min(I,L)}else{I=(C.labelDistance-(A.demanCount+1)*J)/(A.multiple?(A.demanCount+0.5):1.5)}var M=(z.histogram.colors&&z.histogram.colors.length>0?z.histogram.colors:null)||LChart.Const.Defaults.FillColors;if(v==u.ID){u.coordinates.draw=D;u._configs.legendColors=M}var N=function(a,b,c,d,e,f,g){u.DrawFigures.createRectangleFill(a,b,c,d,e,g||G);if(f){var h=f.value[0];var i=f.value[1];if(h>i){h=f.value[1];i=f.value[0]}var j=z.smallLabel;if(j.show){var k=typeof j.content=='function'?j.content.call(z,h):'';if(k){var l=f.smallfontsize||j.fontsize||LChart.Methods.CapValue(d,18,11);var m=f.smallfontweight||j.fontweight;var n=f.smallfontcolor||j.color;var o=a+c/2;var p=b+d+l*1.15;u.DrawFigures.createText(k,o,p,'center',m,l,j.fontfamily,n)}}j=z.bigLabel;if(j.show){var q=typeof j.content=='function'?j.content.call(z,i):'';if(q){var l=f.bigfontsize||j.fontsize||LChart.Methods.CapValue(d,18,11);var m=f.bigfontweight||j.fontweight;var n=f.bigfontcolor||j.color;var o=a+c/2;var p=b-l/3;u.DrawFigures.createText(q,o,p,'center',m,l,j.fontfamily,n)}}}};var O=function(d,f,g,h,i,j,k,l){this.indexX=d;this.indexY=f;this.left=g;this.top=h;this.width=i;this.height=j;this.data=l;this.isHovered=false;this.color=k;this.redraw=function(a,b){if(arguments.length==1&&typeof arguments[0]=='boolean'){b=arguments[0];a=undefined}var c=G;if(F&&a){c=LChart.Methods.DeepCopy(G);c.color=a}N(this.left,this.top,this.width,this.height,a||this.color,b?this.data:null,c)};this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(z.click||null);if(a){a(this.data,e)}};if(z.tip.show&&typeof z.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=this.left+this.width/2+5;var b=this.top+this.height/2;this.tip=u._createTip(z.tip.content.call(z,this.data),a,b);if(a+this.tip.clientWidth>C.maxX){u._changeTip(this.tip,a-this.tip.clientWidth)}var c=this;c.tip.onclick=function(e){c.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var P=function(e,f){var g=function(a){var b=(z.animateY?e:1)*(C.maxY-C.minY)*u._getFormatDiff(A.vValueType,A.vMinValue,a)/u._getFormatDiff(A.vValueType,A.vMinValue,A.vMaxValue);return b};var h=function(a,b,c){var d=(c&&z.animateY?e:1)*(C.maxY-C.minY)*u._getFormatDiff(A.vValueType,a,b)/u._getFormatDiff(A.vValueType,A.vMinValue,A.vMaxValue);return d};for(var i=0,item;item=w[i];i++){var j=(z.animateX?e:1)*I;if(A.multiple){var l=item.color||M[i%M.length];var m=H?item.percent:item.value;for(var k=0;k<m.length;k++){var n=m[k];var o=A.demanCount/2-i;var p=C.startPos+C.labelDistance*k-o*I-(o-0.5)*J;var q=g(n);var r=C.maxY-q;var q=h(n[0],n[1],true);var r=C.maxY-q-h(A.vMinValue,Math.min(n[0],n[1]));if(f>=1){var s={click:item.click,mouseover:item.mouseover,mouseleave:item.mouseleave,text:item.text,indexX:k,indexY:i,bigfontcolor:item.bigfontcolor,bigfontsize:item.bigfontsize,bigfontweight:item.bigfontweight,smallfontcolor:item.smallfontcolor,smallfontsize:item.smallfontsize,smallfontweight:item.smallfontweight};if(H){s.percent=n;s.value=item.value[k]}else{s.value=n}var t=new O(k,i,p,r,j,q,l,s);u.shapes[v].histograms.push(t);N(p,r,j,q,l,s);if(!u.coordinates.histograms[v][k]){u.coordinates.histograms[v][k]=[]}u.coordinates.histograms[v][k][i]={left:p,top:r,width:j,height:q,color:l}}else{N(p,r,j,q,l)}}}else{var n=H?item.percent:item.value;var p=C.startPos+C.labelDistance*i-I/2;var q=h(n[0],n[1],true);var r=C.maxY-q-h(A.vMinValue,Math.min(n[0],n[1]));var l=item.color||(z.histogram.useSameColor?'rgba(69,114,167,1)':M[i%M.length]);if(f>=1){item.indexX=i;item.indexY=1;var t=new O(i,1,p,r,j,q,l,item);u.shapes[v].histograms.push(t);N(p,r,j,q,l,item);u.coordinates.histograms[v][i]={left:p,top:r,width:j,height:q,color:l}}else{N(p,r,j,q,l)}}}};var Q=function(){var h=function(x,y){var a=null;for(var i=0,shape;shape=u.shapes[v].histograms[i];i++){if(shape.left<=x&&shape.left+shape.width>=x&&shape.top<=y&&shape.top+shape.height>=y){a=shape;break}}return a};var j=function(e){var e=window.event||e;var a=u._getMouseLoction(e);var b=h(a.X,a.Y);if(b){b.click(e)}};var k=function(e){var e=window.event||e;var a=u._getMouseLoction(e);var b=h(a.X,a.Y);if(b){u._configs.cursorPointer=true}if(E.currentMouseShape!=b){var c=E.currentMouseShape;if(c){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(z.mouseleave||null);if(d){d(c.data,e)}}if(F||E.currentMouseShape){u.redrawAll()}E.currentMouseShape=b;for(var i=0,c;c=u.shapes[v].histograms[i];i++){if(c!=b&&c.isHovered){c.isHovered=false;if(c.hideTip){c.hideTip()}}}if(b){b.isHovered=true;var f=z.mouseoverTransparency;b.redraw('rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')');if(b.showTip){b.showTip()}var g=typeof b.data.mouseover=='function'?b.data.mouseover:(z.mouseover||null);if(g){g(b.data,e)}}}};u._addEventListener('click',j);u._addEventListener('mousemove',k)};var R=function(){for(var i=0,shape;shape=u.shapes[v].histograms[i];i++){shape.redraw(true)}};return{drawSegments:P,mouseEvents:Q,redraw:R}};