if(!window.LChart){throw new Error('未能加载loongchart.core.js，该js必须在其他LChart框架的js加载之前被引用。\n'+'Not loaded loongchart.core.js which must be loaded before other LChart\'s js.');}else{LChart.Const.Skins.BlackAndWhite.Polar3D={SeparateLineColor:null,OuterLabelColor:null,OuterLabelBorderColor:null,OuterLabelBackColor:'rgba(255,255,255,0.3)',StaffFontColor:null,StaffBackColor:null,ScaleLineColors:null}}LChart.Polar3D=LChart.getCore().__extends({GraphType:'Polar3D'});LChart.Polar3D._spreadSkin=function(a,b){a.separateLine={};a.outerLabel={};a.staff={};a.scale={};a.separateLine.color=b.SeparateLineColor||null;a.outerLabel.color=b.OuterLabelColor||null;a.outerLabel.backcolor=b.OuterLabelBackColor||null;a.outerLabel.bordercolor=b.OuterLabelBorderColor||null;a.staff.fontcolor=b.StaffFontColor||null;a.staff.backcolor=b.StaffBackColor||null;a.scale.linecolors=b.ScaleLineColors||null};LChart.Polar3D._getDefaultOptions=function(b){var c=LChart.Methods.Extend(b,{offX:0,offY:0,radius:null,margin:null,colors:null,animateRotate:true,animateScale:true,scaleOverlay:true,startAngle:null,averageAngle:false,reflection3d:{reflectoffX:null,reflectoffY:null,zoomX:null,zoomY:null},separateLine:{show:false,color:null,width:null},scale:{linewidth:0.5,minvalue:null,maxvalue:null,interval:null,linecolors:null},staff:{show:true,content:function(a){return a.toString()},fontcolor:null,fontfamily:null,fontsize:null,fontweight:null,directions:['n','s','e','w'],backcolor:'rgba(255,255,255,0.3)'},outerLabel:{show:true,content:function(a){return a.text+' '+a.percent.toFixed(1)+'%'},withlegend:true,legendtype:null,length:null,color:null,backcolor:'rgba(220,220,220,0.2)',bordercolor:null,borderwidth:0.5,fontsize:null,fontfamily:null}});return c};LChart.Polar3D._getCheckOptions=function(){return{__top:[['offX','n'],['offX','n'],['radius','n'],['margin','n'],['colors','ca'],['animateRotate','b'],['animateScale','b'],['startAngle','n'],['averageAngle','b']],reflection3d:[['reflectoffX','n'],['reflectoffY','n'],['zoomX','n'],['zoomY','n']],separateLine:[['show','b'],['color','c'],['width','n']],scale:[['minvalue','n'],['maxvalue','n'],['interval','n'],['linecolors','ca']],staff:[['show','b'],['content','f'],['fontcolor','c'],['fontfamily','s'],['fontsize','n'],['fontweight','s'],['directions','sa'],['backcolor','c']],outerLabel:[['show','b'],['content','f'],['withlegend','b'],['legendtype','s'],['length','n'],['color','c'],['backcolor','c'],['bordercolor','c'],['borderwidth','n'],['fontsize','n'],['fontfamily','s']]}};LChart.Polar3D._drawgraphic=function(w,z,A,B){var C=w._computeSegmentTotal(A);var D=A.length;var E=3;var F=3;var G=B.reflection3d.zoomX||1.2;var H=B.reflection3d.zoomY||0.9;if(w._configs._isIE678.isIE678){G=1;H=1}var I=w._computeRadiusForPies(B,G,H);if(w._configs._isIE678.isIE678){I.maxRadius*=0.9}var J=(B.colors&&B.colors.length>0?B.colors:null)||LChart.Const.Defaults.FillColors;var K=z==w.ID;if(K){w.coordinates.draw=I.coordinate;w._configs.legendColors=J}var L=w._getComputed(0,'n',B.scale,C.minval,C.maxval,8);var M=!B.radius||!LChart.Methods.IsNumber(B.radius)?I.maxRadius:B.radius;if(!w.coordinates.polar){w.coordinates.polar={}}w.coordinates.polar[z]={radius:M,centerX:I.centerX,centerY:I.centerY,outerlabels:[],staff:[],cemicircles:[]};w.shapes[z]={cemicircles:[],outerLabels:[]};var N=w.shapes[z];var O=B.reflection3d.reflectoffX||0;var P=B.reflection3d.reflectoffY||M/6;var Q=B.separateLine.show?(B.separateLine.width||1):0;var R=B.separateLine.color||'#ffffff';var S=Math.PI*(B.startAngle==null?-0.5:B.startAngle);var T=true;var U=w._configs.specificConfig[z];var V=function(a,b,c){var d=(b+c)/2;var e=I.centerX;var f=I.centerY;var g=Math.cos(d);var h=Math.sin(d);var i=e+Math.cos(b)*a;var j=f+Math.sin(b)*a;var k=e+Math.cos(c)*a;var l=f+Math.sin(c)*a;var m=e+O;var n=f+P;var o=m+Math.cos(b)*a;var p=n+Math.sin(b)*a;var q=m+Math.cos(c)*a;var r=n+Math.sin(c)*a;return{midAngle:d,centerX:e,centerY:f,startX:i,startY:j,endX:k,endY:l,radius:a,darkCenterX:m,darkCenterY:n,darkStartX:o,darkStartY:p,darkEndX:q,darkEndY:r}};var W=function(f,g,h,j,k,l,m,n){this.index=f;this.color=g;this.radius=h;this.percent=j;this.angleMin=k;this.angleMax=l;this.midAngle=m;this.isHovered=false;this.data=n;this.redraw=function(a){var b=a;for(var i=0;i<4;i++){Z(i,this.radius,this.angleMin,this.angleMax,a||this.color,b,b?a:this.data.darksidecolor)}};this.computeinfo=function(a){if(!this._computeinfo||a){this._computeinfo=V(this.radius,this.angleMin,this.angleMax)}return this._computeinfo};this.contact=null;this.click=function(e){var a=typeof this.data.click=='function'?this.data.click:(B.click||null);if(a){a(this.data,e)}};if(B.tip.show&&typeof B.tip.content=='function'){this.tip=null;this.showTip=function(){if(this.tip){this.tip.style.display='inline'}else{var a=(this.angleMin+this.angleMax)/2;var b=(I.centerX+this.radius*0.5*Math.cos(a))*G;var c=(I.centerY+this.radius*0.5*Math.sin(a))*H;this.tip=w._createTip(B.tip.content(this.data),b,c);var d=this;d.tip.onclick=function(e){d.click(e)}}};this.hideTip=function(){if(this.tip){this.tip.style.display='none'}}}};var X=function(h,i,j,k,l,m,n,o){this.content=h;this.length=i;this.width=j;this.height=k;this.floatright=l;this.floattop=m;this.data=n;this.contact=o;this.color=this.contact.color;this.index=this.contact.index;this.resetposition=function(){var a=this.length;var b=1.08;var c=this.contact.computeinfo();var d=Math.cos(c.midAngle);var e=Math.sin(c.midAngle);var f=d>0?1+d:0;var g=e>0?e:0;this.startX=(m?c.centerX:(c.centerX+c.darkCenterX)/2)+c.radius*d;this.startY=(m?c.centerY:(c.centerY+c.darkCenterY)/2)+c.radius*e;this.left=(m?c.centerX:c.darkCenterX)+M*b*d+(this.floatright?0:-this.width);this.top=(m?c.centerY:c.darkCenterY)+M*b*e+g*a-a-F};this.endX=function(){return this.left+(this.floatright?0:this.width)};this.endY=function(){return this.top+this.height/2}};var Y=function(a){return(a-L.minvalue)/(L.maxvalue-L.minvalue)};var Z=function(a,b,c,d,e,f,g,h,i){var j=V(b,c,d);g=g||LChart.Methods.getDarkenColor(e);var k=f?0:Q;w.ctx.save();w.ctx.transform(G,0,0,H,0,0);switch(a){case 0:w.DrawFigures.createArc(j.darkCenterX,j.darkCenterY,j.radius,0,null,g,c,d,true);break;case 1:w.DrawFigures.createCloseFigure([[j.darkCenterX,j.darkCenterY],[j.centerX,j.centerY],[j.endX,j.endY],[j.darkEndX,j.darkEndY]],g);break;case 2:w.DrawFigures.createCloseFigure([[j.darkCenterX,j.darkCenterY],[j.centerX,j.centerY],[j.startX,j.startY],[j.darkStartX,j.darkStartY]],g);break;default:w.DrawFigures.createArc(j.centerX,j.centerY,j.radius,k,R,e,c,d,true);if(k>0){if(LChart.Methods.JudgeBetweenAngle(0,Math.PI,c)){w.DrawFigures.createLine(j.startX,j.startY,j.darkStartX,j.darkStartY,k,R)}if(LChart.Methods.JudgeBetweenAngle(0,Math.PI,d)){w.DrawFigures.createLine(j.endX,j.endY,j.darkEndX,j.darkEndY,k,R)}}break}w.ctx.restore();var l=B.outerLabel;if(h&&l.show&&typeof l.content=='function'){var m=l.length||M/12;var n=LChart.Methods.JudgeBetweenAngle(-Math.PI*0.5,Math.PI*0.5,j.midAngle);var o=LChart.Methods.JudgeBetweenAngle(-Math.PI,0,j.midAngle);var p=l.content(h);var q=w.DrawFigures.measureText(p,null,l.fontsize||(m-1),l.fontfamily);var r=q+(l.withlegend?m+3*E:2*E);var s=m+F*2;var t=new X(p,m,r,s,n?1:0,o?1:0,h,i);N.outerLabels.push(t);i.contact=t}};var ba=function(g){var h=B.scale;var j=h.linewidth;if(!(h.linewidth>0)){return}var i=0;for(var k=L.minvalue+L.interval;k<=L.maxvalue;k+=L.interval){var l=h.linecolors&&h.linecolors.length>0?h.linecolors[i%h.linecolors.length]:'rgb(190,190,190)';w.ctx.save();w.ctx.transform(G,0,0,H,0,0);w.DrawFigures.createArc(I.centerX,I.centerY,M*Y(k),j,l);w.ctx.restore();i++}var m=B.staff;var n=m.content;if(!m.show||typeof n!='function'||m.directions==null||!(m.directions.length>0)){return}var o=m.fontsize||M/L.scalecount*0.6;var p=m.backcolor;var q=0;if(p){for(var k=L.minvalue+L.interval;k<=L.maxvalue;k+=L.interval){var r=w.DrawFigures.measureText(n(k),m.fontweight,o,m.fontfamily);q=Math.max(q,r)}}i=0;var s=function(a,b,c){w.ctx.save();w.ctx.transform(G,0,0,H,0,0);var d=(b=='n'||b=='s')?I.centerX:(b=='w'?I.centerX-c:I.centerX+c);var e=(b=='w'||b=='e')?I.centerY+o/2.5:(b=='n'?I.centerY-c+o/2.5:I.centerY+c+o/2.5);if(p){w.DrawFigures.createRectangleFill(d-q/2-1,e-o+1,q+2,o+2,p)}var f=w.DrawFigures.createText(a,d,e,'center',m.fontweight,o,m.fontfamily,t);if(g){w.coordinates.polar[z].staff.push({direction:b,text:a,left:d-f/2,right:d+f/2,top:e-o,bottom:e,size:o,length:f})}w.ctx.restore()};for(var k=L.minvalue+L.interval;k<=L.maxvalue;k+=L.interval){var t=m.fontcolor||'#000000';var u=M*Y(k);var v=n(LChart.Methods.FormatNumber(k));if(m.directions.__contains('n')){s(v,'n',u)}if(m.directions.__contains('s')){s(v,'s',u)}if(m.directions.__contains('e')){s(v,'e',u)}if(m.directions.__contains('w')){s(v,'w',u)}i++}};var bb=function(l,m){var n=B.outerLabel;if(!(n.show&&typeof n.content=='function')){return}var o=(K?I.coordinate.minY:5)/H;var p=(K?I.coordinate.maxY:w.canvas.height-5)/H;N.outerLabels.sort(function(a,b){return a.index-b.index});if(T){for(var i=0,shape;shape=N.outerLabels[i];i++){shape.resetposition()}T=false}var q=function(){var c=function(a,b){return Math.max(a.left,b.left)<=Math.min(a.left+a.width,b.left+b.width)&&Math.max(a.top,b.top)<=Math.min(a.top+a.height,b.top+b.height)};var d=[];var e=[];var f=[];var g=[];for(var i=0,shape;shape=N.outerLabels[i];i++){while(o>shape.top){shape.top+=F;shape.left+=shape.floatright?E:-E}while(p<shape.top+shape.height){shape.top-=F;shape.left+=shape.floatright?E:-E}if(shape.floatright&&shape.floattop){f.push(shape)}else if(shape.floatright&&!shape.floattop){g.push(shape)}else if(!shape.floatright&&shape.floattop){d.push(shape)}else{e.push(shape)}}var h=0;var j=[];var k=function(r){if(j.length>0){for(var i=0,compare;compare=j[i];i++){while(c(compare,r)&&h<1000){r.top+=r.floattop?F:-F;r.left+=r.floatright?E:-E;h++}}}j.push(r)};for(var i=d.length-1;i>=0;i--){k(d[i])}j=[];for(var i=0;i<e.length;i++){k(e[i])}j=[];for(var i=0;i<f.length;i++){k(f[i])}j=[];for(var i=g.length-1;i>=0;i--){k(g[i])}};var s=function(a,b){var c=a;w.ctx.save();w.ctx.transform(G,0,0,H,0,0);if(!b){w.DrawFigures.createQuadraticCurve(c.startX,c.startY,c.startX*0.8+c.endX()*0.2,c.startY*0.2+c.endY()*0.8,c.endX(),c.endY(),1,n.bordercolor);if(n.backcolor){w.DrawFigures.createRectangleFill(c.left,c.top,c.width,c.height,n.backcolor)}var d=n.fontsize||(c.length-1);var e=c.left+(c.floatright?E+(n.withlegend?c.length+E:0):c.width-E);var f=c.top+c.length/2+d/2+F/2;w.DrawFigures.createText(c.content,e,f,c.floatright?'left':'right',null,d,n.fontfamily,n.color);if(n.borderwidth&&n.borderwidth>0){w.DrawFigures.createRectangleBorder(c.left,c.top,c.width,c.height,n.borderwidth,n.bordercolor)}}if(n.withlegend){var g=n.legendtype||'s';w.DrawFigures.createPointElement(g,c.left+E,c.top+F,c.length,c.color,g!='x',b,2,g=='x')}w.ctx.restore()};if(l){s(l.contact,m)}else{q();w.coordinates.polar[z].outerlabels.length=0;for(var i=0,shape;shape=N.outerLabels[i];i++){s(shape);w.coordinates.polar[z].outerlabels[i]={index:shape.contact.index,left:shape.left,top:shape.top,width:shape.width,height:shape.height}}}};var bc=function(){if(!B.scaleOverlay){ba()}for(var i=0,shape;shape=N.cemicircles[i];i++){shape.redraw()}if(B.scaleOverlay){ba()}bb()};var bd=function(e,f){var g=S;var h=B.animation&&B.animateScale?e:1;var j=B.animation&&B.animateRotate?e:1;var k=f>=1;if(!B.scaleOverlay){ba(k)}var l=[];for(var i=0,item;item=A[i];i++){var m=(item.value/C.segmentTotal)*100;var n=j*Math.PI*2*(B.averageAngle?1/D:(m/100));var o=item.color||J[i%J.length];var p=g;var q=g+w._formatSegmentAngle(n);var r=(p+q)/2;if(k){item.percent=m}var s=new W(i,o,M*h*Y(item.value),m,p,q,r,item);w._methodsFor3D.computeLoc(s);l.push(s);g=q}l.sort(w._methodsFor3D.pieshapeSort);var t=function(a,b,c,d){Z(b,a.radius,a.angleMin,a.angleMax,a.color,false,a.data.darksidecolor,k&&b==3?a.data:null,k&&b==3?a:null)};for(var i=0,shapeitem;shapeitem=l[i];i++){t(shapeitem,0);t(shapeitem,1);t(shapeitem,2);t(shapeitem,3)}if(B.scaleOverlay){ba(k)}if(k){N.cemicircles=l;bb()}};var be=function(){var k=function(x,y){var a=null;for(var i=0,g;g=N.cemicircles[i];i++){var b=g.computeinfo();var c=LChart.Methods.GetCurrentAngle(x,y,b.centerX,b.centerY);var d=(Math.pow(x-b.centerX,2)+Math.pow(y-b.centerY,2)<=Math.pow(g.radius,2))&&LChart.Methods.JudgeBetweenAngle(g.angleMin,g.angleMax,c);var e=false;if(B.outerLabel&&B.outerLabel.show&&g.contact){var f=g.contact;if(x>=f.left&&x<=f.left+f.width&&y>=f.top&&y<=f.top+f.height){e=true}}if(d||e){a=g;break}}if(!a){for(var i=N.cemicircles.length-1;i>=0;i--){var g=N.cemicircles[i];var b=g.computeinfo();var h=LChart.Methods.GetCurrentAngle(x,y,b.darkCenterX,b.darkCenterY);var j=(Math.pow(x-b.darkCenterX,2)+Math.pow(y-b.darkCenterY,2)<=Math.pow(g.radius,2))&&LChart.Methods.JudgeBetweenAngle(g.angleMin,g.angleMax,h);if(j){a=g;break}}}return a};var l=function(e){var e=window.event||e;var a=LChart.Methods.tranferLocation(w._getMouseLoction(e),G,H);var b=k(a.X,a.Y);if(b){b.click(e)}};var m=function(e){var e=window.event||e;var a=LChart.Methods.tranferLocation(w._getMouseLoction(e),G,H);var b=k(a.X,a.Y);if(b){w._configs.cursorPointer=true}if(U.currentMouseShape!=b){var c=U.currentMouseShape;if(c){var d=typeof c.data.mouseleave=='function'?c.data.mouseleave:(B.mouseleave||null);if(d){d(c.data,e)}}if(U.currentMouseShape){w.redrawAll()}U.currentMouseShape=b;for(var i=0,c;c=N.cemicircles[i];i++){if(c.isHovered){c.isHovered=false;if(c.hideTip){c.hideTip()}}}if(b){b.isHovered=true;var f=B.mouseoverTransparency;var g='rgba(255,255,255,'+(f>0&&f<1?f:0.2)+')';b.redraw(g);bb(b,g);if(b.showTip){b.showTip()}var h=typeof b.data.mouseover=='function'?b.data.mouseover:(B.mouseover||null);if(h){h(b.data,e)}}}};w._addEventListener('click',l);w._addEventListener('mousemove',m)};return{drawSegments:bd,mouseEvents:be,redraw:bc}};